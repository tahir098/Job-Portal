@page
@model JobPortal.Areas.Job.Pages.IndexModel

@{
    ViewData["Title"] = "Index";
}

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<div class="form-group">
    <div class="col-12">
        <h2>All Jobs</h2>
        <hr />
    </div>
</div>

<div class="form-group">
    <div class="col-12">
        <input class="form-control" id="searchBar" placeholder="Search jobs by title">
    </div>
</div>
<br />

<div class="form-group">
    <div class="col-12">
        <div id="cardBody">
            @if (Model.Job.Any())
            {
                @foreach (var item in Model.Job)
                {
                    <div class="card">
                        <div class="card-body">
                            <a asp-route-id="@item.JobId" asp-page="./Details">
                                <h5 class="card-title"> @item.Title</h5>
                            </a>
                            <h6 class="card-subtitle mb-2 text-muted">City: @item.City</h6>
                            <p class="card-text">Description: @item.Description.Substring(0, 9)...</p>
                            <p class=" card-text text-muted" >Posted on: @item.PostDate.ToShortDateString()</p>
                        </div>

                    </div>
                    <br />
                }
            }
        </div>
        <nav aria-label="Page navigation example">
            <ul class="pagination">
                <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">Next</a></li>
            </ul>
        </nav>
    </div>
</div>


@section Scripts{

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        $(function () {

            $("#searchBar").autocomplete({

                source: function (request, response) {
                    $.ajax({
                        url: '/Job/Index?handler=Jobs',
                        data: { term: request.term },
                        contentType: 'application/json',
                        type: 'GET',
                        headers: {
                            RequestVerificationToken:
                                $('input:hidden[name="__RequestVerificationToken"]').val()
                        },
                        success: function (data) {
                            //  alert(JSON.stringify(data));

                            $("#cardBody").empty();
                            $.each(data, function (i, element) {

                                $('#cardBody').append(
                                                                `<div class="card">
                                                                         <div class="card-body">
                                                                           <a href="`+ (url= '/Job/Details?id='+element.jobId) + `">
                                                                              <h5 class="card-title">`+ (element.title) + `</h5>
                                                                            </a>
                                                                            <h6 class="card-subtitle mb-2 text-muted">`+ (element.city) + `</h6>
                                                                            <p class="card-text">`+ (element.description) + `...</p>
                                                                            <p class="text-muted">Posted on: `+ new Date(element.postDate).toDateString() + `</p>
                                                                        </div>
                                                                    </div>
                                                                <br/>`
                                ).html();
                            })
                        },
                        error: function (err) {
                            console.log(err);
                        }
                    });
                } 

            });
        });
    </script>
}